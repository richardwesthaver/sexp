#+TITLE: sxp
#+SETUPFILE: ~/org/clean.theme
#+INFOJS_OPT: view:info toc:nil
* Status
+ state :: WIP
+ todo ::
  - [-] Rust
    - [-] {lib,tests}.rs
      - form.rs
  - [-] Python
  - [-] Emacs Lisp
  - [X] Common Lisp
* Overview
** Introduction
[[https://en.wikipedia.org/wiki/S-expression][S-expressions]] are tree-like data structures classically defined as:
1. an atom of the form ~x~, or
2. a cons cell of the form ~(x . y)~ where x and y are
   S-expressions.

A /cons cell/ is simply an ordered pair.

These rules define the core properties of S-expressions. An atom is
left undefined, for us to define ourselves. For convenience, we use
simple unquoted names or /Symbols/. Thus the name /Symbolic
Expressions/.

In modern times we define some additional shorthand rules:
4. if the /cdr/ of a cons cell is another cons cell, we can omit the
   dot: ~.~.
5. An end-of-list atom must be specified (typically ~NIL~, which may
   also represents the empty cons cell ~()~).
5. if the /cdr/ of a cons cell is ~NIL~, we can omit the dot and the
   ~NIL~.

This gives us S-expressions of the following form:
#+begin_src lisp-data
  (foo bar baz) ;; === (foo . (bar . (baz . NIL)))
#+end_src

These are the rules that pretty much every Lisp implementation has
agreed on. S-expressions are used for both data and code in the Lisp
family of languages, and they helps maintain that strong familial bond
between Lisps.

You can write *executable code*, like this emacs-lisp macro:
#+begin_src emacs-lisp :export code :results silent
  (defmacro my-data (&rest data)
    "Print '(my-data ,@DATA)'. This is a macro so that we avoid
   evaluation of DATA."
    (print (format "%S" `,(cons 'my-data data))))
#+end_src

or *structured data*, in this case a checksumed list of bits:
#+begin_src lisp-data
  (my-data :checksum 12795862 :frame (0 1 1 0 1 0 0 0))
#+end_src

with the same syntax. S-expressions are a building material which
exhibits the most fundamental of 'dualities of syntax'.

However, of upmost importance is that this duality /only applies to
Lisps/. S-expressions aren't that special to non-Lispers - they are at
best a poorly supported and obscure data format and at worst an
absolute nuisance which is obsolete.

To compensate for this, us Lisp guys like to implement Lisp
interpreters wherever we go:

"See?" we say, "You can use it to execute code!"  as we type ~(+ 2 2)~
in the REPL and print ~4~.

Realistically, why do we need this? We already have a general purpose
language (the one you used to implement your Lisp), we already have a
portable data format which is supported by our language's standard
library.[fn:1]

The honest and fair truth is that *languages don't need Lisp*.

However, it may be the case that *languages need S-expressions* and by
extension, S-expressions need some additional rules. We will call this
extended definition *SXP*.

[fn:1] There are good reasons for needing Lisp, just not in this case.

** Portable Data
Portable Data is a difficult phrase to define, but we'll take a stab
at it:

Portable data is data which is structured in such a way as to maximize
the following properties:
1. Human-readability
2. Machine-readability
3. Size in bytes
parameterized by:
1. An interface for data transmission between two or more entities.
2. The features of the entities themselves.

The formal specification of such data is what we would call a
/portable data format/.

The canonical example today would likely be JSON - originally
developed for the Javascript language and ranking reasonably high
across all properties.

** Meta Data
There is another category; one which we will call Meta Data. It is a
slight modification of the word 'Metadata' meaning 'data about data':

Meta Data is a portable data format which is optimized for describing
the following entities:
1. Data Types
2. Data Structures

Another way to think of this interpretation is that with Meta Data we
want to think as if we are authoring the data manually - we want to be
able to express as many things as possible. We want to have all the
power at our fingertips and be able to extend the format as needed.

Of course, the formal specification of such data is the /meta data
format/.

One could consider XML to be in this category, which is still popular
in many Knowledge Management systems. JSON can be and often is used
for this purpose as well.

The point I will argue from here is that neither XML nor JSON have
found the optimal point at which the ability to describe data types
and structures is maximized. In other words, XML and JSON are not
powerful enough.
** Prior Art
- [[file:draft-rivest-sexp-00.txt][draft-rivest-sexp-00.txt]]
  - focus is on an exact binary format which is referred to as the
    Canonical representation. There are additional representations
    available through custom printer modes.
- [[https://twisted.org/documents/16.1.1/core/specifications/banana.html][Banana]]
  - extensible /transport/ protocol for sending and receiving
    S-expressions. binary format using tagged values.
- [[https://github.com/mjsottile/sfsexp][sfsexp]]
  - C/C++
- examples: [[https://rosettacode.org/wiki/S-expressions][S-expressions on Rosetta Code]].

* Implementations
** Common Lisp
The Common Lisp implementation is in the root directory. The default
implementation uses =read= and =print= functions. A =esrap-impl= is
also provided using the =esrap= parsing library.

#+name: sxp-cl-tests
#+begin_src shell :results output replace :exports both
make test
#+end_src

#+RESULTS: sxp-cl-tests
#+begin_example
sbcl --noinform --non-interactive --eval '(asdf:load-asd "sxp.asd")' --eval '(ql:quickload :sxp)'  --eval '(asdf:compile-system :sxp)'
To load "sxp":
  Load 1 ASDF system:
    sxp
; Loading "sxp"

sbcl --noinform --non-interactive --eval '(asdf:load-asd "sxp.asd")' --eval '(ql:quickload :sxp)'  --eval '(ql:quickload :sxp/tests)' --eval '(asdf:test-system :sxp)'
To load "sxp":
  Load 1 ASDF system:
    sxp
; Loading "sxp"

To load "sxp/tests":
  Load 1 ASDF system:
    sxp/tests
; Loading "sxp/tests"


Running test suite SXP
 Running test SXP-FILE .
 Did 1 check.
    Pass: 1 (100%)
    Skip: 0 ( 0%)
    Fail: 0 ( 0%)

#+end_example

#+name: sxp-cl-bench
#+begin_src shell :results output replace :exports both
make bench
#+end_src

#+RESULTS: sxp-cl-bench
#+begin_example
sbcl --noinform --non-interactive --eval '(asdf:load-asd "sxp.asd")' --eval '(ql:quickload :sxp)'  --eval '(asdf:compile-system :sxp)'
To load "sxp":
  Load 1 ASDF system:
    sxp
; Loading "sxp"

sbcl --noinform --non-interactive --eval '(asdf:load-asd "sxp.asd")' --eval '(ql:quickload :sxp)'  --eval '(ql:quickload :sxp/bench)' --eval '(require :sb-sprof)' --eval '(sb-sprof:start-profiling :sample-interval 0.001)' --eval '(sxp-bench:run-bench t)' --eval '(sb-sprof:stop-profiling)' --eval '(sb-sprof:report)'
To load "sxp":
  Load 1 ASDF system:
    sxp
; Loading "sxp"

To load "sxp/bench":
  Load 1 ASDF system:
    sxp/bench
; Loading "sxp/bench"

Writing output to "report.sxp"

Number of samples:   24
Sample interval:     0.001 seconds
Total sampling time: 0.024 seconds
Graph cycles:        0
Sampled threads:
   #<THREAD tid=306736 "main thread" RUNNING {10047D0113}> (6896/1048576 bytes, 33 hash buckets)

                               Callers
                 Total.     Function
 Count     %  Count     %      Callees
------------------------------------------------------------------------
     2   8.3                   SB-UNIX:UNIX-LSTAT [93]
     2   8.3                   SB-UNIX:FD-TYPE [66]
     4  16.7      4  16.7   foreign function fstatat [1]
------------------------------------------------------------------------
     4  16.7                   (FLET "WITHOUT-INTERRUPTS-BODY-5" :IN SB-IMPL::RELEASE-FD-STREAM-RESOURCES) [79]
     4  16.7      4  16.7   foreign function __close [2]
------------------------------------------------------------------------
     1   4.2                   SB-PRETTY::PRETTY-SOUT [61]
     1   4.2                   SB-PRETTY::PRETTY-OUT [59]
     3  12.5      3  12.5   SB-PRETTY::ENSURE-SPACE-IN-BUFFER [3]
------------------------------------------------------------------------
     3  12.5                   SB-IMPL::FLUSH-OUTPUT-BUFFER [73]
     3  12.5      3  12.5   foreign function __write [4]
------------------------------------------------------------------------
     3  12.5      3  12.5   foreign function __open64 [5]
------------------------------------------------------------------------
     3  12.5                   READ-CHAR [20]
     2   8.3      3  12.5   SB-IMPL::INPUT-CHAR/UTF-8 [8]
     1   4.2                   SB-IMPL::REFILL-INPUT-BUFFER [87]
------------------------------------------------------------------------
     2   8.3                   SB-SYS:GET-SYSTEM-INFO [55]
     2   8.3      2   8.3   foreign function getrusage [6]
------------------------------------------------------------------------
     2   8.3                   SB-IMPL::PRINT-FLOAT [14]
     2   8.3      2   8.3   TRUNCATE [7]
------------------------------------------------------------------------
     2   8.3                   OPEN [56]
     2   8.3      2   8.3   foreign function access [9]
------------------------------------------------------------------------
     7  29.2                   SB-IMPL::READ-MAYBE-NOTHING [85]
     1   4.2      7  29.2   SB-IMPL::READ-LIST [21]
     1   4.2                   SB-IMPL::FLUSH-WHITESPACE [24]
     5  20.8                   SB-IMPL::READ-MAYBE-NOTHING [85]
------------------------------------------------------------------------
     1   4.2                   (LABELS SB-IMPL::HANDLE-IT :IN SB-KERNEL:OUTPUT-OBJECT) [41]
     1   4.2      4  16.7   SB-IMPL::PRINT-FLOAT [14]
     2   8.3                   TRUNCATE [7]
     1   4.2                   (LAMBDA (SB-IMPL::D) :IN SB-IMPL::PRINT-FLOAT) [58]
------------------------------------------------------------------------
     2   8.3                   SB-IMPL::READ-TOKEN [22]
     1   4.2                   SB-IMPL::%READ-PRESERVING-WHITESPACE [84]
     1   4.2      4  16.7   READ-CHAR [20]
     3  12.5                   SB-IMPL::INPUT-CHAR/UTF-8 [8]
------------------------------------------------------------------------
     1   4.2                   SB-IMPL::READ-MAYBE-NOTHING [85]
     1   4.2      4  16.7   SB-IMPL::READ-TOKEN [22]
     2   8.3                   READ-CHAR [20]
     1   4.2                   DIGIT-CHAR-P [23]
------------------------------------------------------------------------
     1   4.2                   SB-PRETTY::OUTPUT-LINE [67]
     1   4.2                   SB-KERNEL:OUTPUT-SYMBOL [64]
     1   4.2                   (LABELS SB-IMPL::HANDLE-IT :IN SB-KERNEL:OUTPUT-OBJECT) [41]
     1   4.2      3  12.5   SB-IMPL::%WRITE-STRING [12]
     1   4.2                   SB-IMPL::FD-SOUT [16]
------------------------------------------------------------------------
     1   4.2                   SB-PRETTY::FITS-ON-LINE-P [50]
     1   4.2      1   4.2   SB-PRETTY::INDEX-COLUMN [10]
------------------------------------------------------------------------
     1   4.2                   foreign function interrupt_handle_pending [52]
     1   4.2      1   4.2   foreign function pthread_sigmask [11]
------------------------------------------------------------------------
     1   4.2                   SB-SYS:MAKE-FD-STREAM [57]
     1   4.2      1   4.2   SB-IMPL::SET-FD-STREAM-ROUTINES [13]
------------------------------------------------------------------------
     1   4.2                   SB-IMPL::%FIND-SYMBOL [65]
     1   4.2      1   4.2   SB-IMPL::%LOOKUP-SYMBOL [15]
------------------------------------------------------------------------
     1   4.2                   SB-IMPL::%WRITE-STRING [12]
     1   4.2      1   4.2   SB-IMPL::FD-SOUT [16]
------------------------------------------------------------------------
     1   4.2                   SB-UNIX:UNIX-OPEN [68]
     1   4.2      1   4.2   SB-IMPL::OUTPUT-TO-C-STRING/UTF-8 [17]
------------------------------------------------------------------------
     1   4.2                   SB-IMPL::UNPARSE-NATIVE-PHYSICAL-FILE [75]
     1   4.2      1   4.2   PATHNAME-TYPE [18]
------------------------------------------------------------------------
     1   4.2                   (SB-PCL::FAST-METHOD PRINT-OBJECT (FLOAT T)) [77]
     1   4.2      1   4.2   FLOAT-SIGN [19]
------------------------------------------------------------------------
     1   4.2                   SB-IMPL::READ-TOKEN [22]
     1   4.2      1   4.2   DIGIT-CHAR-P [23]
------------------------------------------------------------------------
     1   4.2                   SB-IMPL::READ-LIST [21]
     1   4.2      1   4.2   SB-IMPL::FLUSH-WHITESPACE [24]
------------------------------------------------------------------------
     1   4.2                   SB-IMPL::READ-MAYBE-NOTHING [85]
     1   4.2      1   4.2   SB-IMPL::RESET-READ-BUFFER [25]
------------------------------------------------------------------------
     1   4.2                   SB-IMPL::REFILL-INPUT-BUFFER [87]
     1   4.2      1   4.2   foreign function read [26]
------------------------------------------------------------------------
    39 162.5                   SB-INT:SIMPLE-EVAL-IN-LEXENV [34]
     0   0.0     39 162.5   SXP-BENCH:RUN-BENCH [35]
     2   8.3                   (LABELS SB-IMPL::RECURSE :IN DELETE-DIRECTORY) [88]
    14  58.3                   SXP-BENCH::RBENCH [80]
    23  95.8                   SXP-BENCH::WBENCH [36]
------------------------------------------------------------------------
    39 162.5                   EVAL [33]
     0   0.0     39 162.5   SB-INT:SIMPLE-EVAL-IN-LEXENV [34]
    39 162.5                   SXP-BENCH:RUN-BENCH [35]
------------------------------------------------------------------------
    39 162.5                   SB-IMPL::PROCESS-EVAL/LOAD-OPTIONS [32]
     0   0.0     39 162.5   EVAL [33]
    39 162.5                   SB-INT:SIMPLE-EVAL-IN-LEXENV [34]
------------------------------------------------------------------------
    39 162.5                   SB-IMPL::TOPLEVEL-INIT [31]
     0   0.0     39 162.5   SB-IMPL::PROCESS-EVAL/LOAD-OPTIONS [32]
    39 162.5                   EVAL [33]
------------------------------------------------------------------------
    39 162.5                   (FLET SB-UNIX::BODY :IN SB-IMPL::START-LISP) [30]
     0   0.0     39 162.5   SB-IMPL::TOPLEVEL-INIT [31]
    39 162.5                   SB-IMPL::PROCESS-EVAL/LOAD-OPTIONS [32]
------------------------------------------------------------------------
    39 162.5                   (FLET "WITHOUT-INTERRUPTS-BODY-3" :IN SB-IMPL::START-LISP) [29]
     0   0.0     39 162.5   (FLET SB-UNIX::BODY :IN SB-IMPL::START-LISP) [30]
    39 162.5                   SB-IMPL::TOPLEVEL-INIT [31]
------------------------------------------------------------------------
    39 162.5                   SB-IMPL::%START-LISP [28]
     0   0.0     39 162.5   (FLET "WITHOUT-INTERRUPTS-BODY-3" :IN SB-IMPL::START-LISP) [29]
    39 162.5                   (FLET SB-UNIX::BODY :IN SB-IMPL::START-LISP) [30]
------------------------------------------------------------------------
    39 162.5                   foreign function call_into_lisp_ [27]
     0   0.0     39 162.5   SB-IMPL::%START-LISP [28]
    39 162.5                   (FLET "WITHOUT-INTERRUPTS-BODY-3" :IN SB-IMPL::START-LISP) [29]
------------------------------------------------------------------------
     0   0.0     39 162.5   foreign function call_into_lisp_ [27]
    39 162.5                   SB-IMPL::%START-LISP [28]
------------------------------------------------------------------------
    14  58.3                   SXP-BENCH::RBENCH [80]
    23  95.8                   SXP-BENCH::WBENCH [36]
     0   0.0     37 154.2   CALL-WITH-TIMING [37]
    14  58.3                   SXP:READ-SXP-FILE [81]
     1   4.2                   SB-IMPL::TIME-GET-SYS-INFO [54]
     1   4.2                   (FLET "CLEANUP-FUN-14" :IN CALL-WITH-TIMING) [53]
    21  87.5                   UIOP/STREAM:CALL-WITH-OUTPUT-FILE [38]
------------------------------------------------------------------------
    23  95.8                   SXP-BENCH:RUN-BENCH [35]
     0   0.0     23  95.8   SXP-BENCH::WBENCH [36]
    23  95.8                   CALL-WITH-TIMING [37]
------------------------------------------------------------------------
    21  87.5                   CALL-WITH-TIMING [37]
     0   0.0     21  87.5   UIOP/STREAM:CALL-WITH-OUTPUT-FILE [38]
     5  20.8                   (FLET "CLEANUP-FUN-3" :IN UIOP/STREAM:CALL-WITH-OUTPUT-FILE) [69]
     4  16.7                   OPEN [56]
    12  50.0                   PRINT [39]
------------------------------------------------------------------------
    14  58.3                   SXP:READ-SXP-FILE [81]
     0   0.0     14  58.3   UIOP/STREAM:CALL-WITH-INPUT-FILE [82]
     2   8.3                   (FLET "CLEANUP-FUN-3" :IN UIOP/STREAM:CALL-WITH-INPUT-FILE) [86]
     3  12.5                   OPEN [56]
     9  37.5                   UIOP/STREAM:SLURP-STREAM-FORMS [83]
------------------------------------------------------------------------
    14  58.3                   CALL-WITH-TIMING [37]
     0   0.0     14  58.3   SXP:READ-SXP-FILE [81]
    14  58.3                   UIOP/STREAM:CALL-WITH-INPUT-FILE [82]
------------------------------------------------------------------------
    14  58.3                   SXP-BENCH:RUN-BENCH [35]
     0   0.0     14  58.3   SXP-BENCH::RBENCH [80]
    14  58.3                   CALL-WITH-TIMING [37]
------------------------------------------------------------------------
    12  50.0                   (LABELS #:BODY-NAME-3 :IN SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER) [46]
     0   0.0     12  50.0   (FLET "PPRINT-BLOCK" :IN PPRINT-FILL) [47]
    11  45.8                   (LABELS SB-IMPL::HANDLE-IT :IN SB-KERNEL:OUTPUT-OBJECT) [41]
     1   4.2                   PPRINT-NEWLINE [48]
------------------------------------------------------------------------
    12  50.0                   (FLET "WITH-PRETTY-STREAM0" :IN SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER) [45]
     0   0.0     12  50.0   (LABELS #:BODY-NAME-3 :IN SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER) [46]
     1   4.2                   (FLET "PPRINT-BLOCK" :IN SB-PRETTY::PPRINT-FUN-CALL) [76]
     1   4.2                   (FLET "PPRINT-BLOCK" :IN SB-PRETTY::PPRINT-IF) [63]
     1   4.2                   SB-PRETTY::START-LOGICAL-BLOCK [60]
    12  50.0                   (FLET "PPRINT-BLOCK" :IN PPRINT-FILL) [47]
------------------------------------------------------------------------
    12  50.0                   SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER [44]
     0   0.0     12  50.0   (FLET "WITH-PRETTY-STREAM0" :IN SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER) [45]
    12  50.0                   (LABELS #:BODY-NAME-3 :IN SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER) [46]
------------------------------------------------------------------------
     2   8.3                   SB-PRETTY::PPRINT-IF [62]
     2   8.3                   SB-PRETTY::PPRINT-FUN-CALL [51]
    12  50.0                   PPRINT-FILL [43]
     0   0.0     12  50.0   SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER [44]
    12  50.0                   (FLET "WITH-PRETTY-STREAM0" :IN SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER) [45]
------------------------------------------------------------------------
    12  50.0                   SB-PRETTY:OUTPUT-PRETTY-OBJECT [42]
     0   0.0     12  50.0   PPRINT-FILL [43]
    12  50.0                   SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER [44]
------------------------------------------------------------------------
    12  50.0                   (LABELS SB-IMPL::HANDLE-IT :IN SB-KERNEL:OUTPUT-OBJECT) [41]
     0   0.0     12  50.0   SB-PRETTY:OUTPUT-PRETTY-OBJECT [42]
     1   4.2                   SB-PRETTY::PPRINT-IF [62]
     1   4.2                   SB-PRETTY::PPRINT-FUN-CALL [51]
    12  50.0                   PPRINT-FILL [43]
------------------------------------------------------------------------
     1   4.2                   (FLET "PPRINT-BLOCK" :IN SB-PRETTY::PPRINT-FUN-CALL) [76]
     2   8.3                   (FLET "PPRINT-BLOCK" :IN SB-PRETTY::PPRINT-IF) [63]
    11  45.8                   (FLET "PPRINT-BLOCK" :IN PPRINT-FILL) [47]
    12  50.0                   PRIN1 [40]
     0   0.0     12  50.0   (LABELS SB-IMPL::HANDLE-IT :IN SB-KERNEL:OUTPUT-OBJECT) [41]
     1   4.2                   (SB-PCL::FAST-METHOD PRINT-OBJECT (FLOAT T)) [77]
     1   4.2                   SB-KERNEL:OUTPUT-SYMBOL [64]
     1   4.2                   SB-IMPL::PRINT-FLOAT [14]
     1   4.2                   SB-IMPL::%WRITE-STRING [12]
    12  50.0                   SB-PRETTY:OUTPUT-PRETTY-OBJECT [42]
------------------------------------------------------------------------
    12  50.0                   PRINT [39]
     0   0.0     12  50.0   PRIN1 [40]
    12  50.0                   (LABELS SB-IMPL::HANDLE-IT :IN SB-KERNEL:OUTPUT-OBJECT) [41]
------------------------------------------------------------------------
    12  50.0                   UIOP/STREAM:CALL-WITH-OUTPUT-FILE [38]
     0   0.0     12  50.0   PRINT [39]
    12  50.0                   PRIN1 [40]
------------------------------------------------------------------------
     9  37.5                   SB-IMPL::%READ-PRESERVING-WHITESPACE [84]
     9  37.5                   UIOP/STREAM:SLURP-STREAM-FORMS [83]
     0   0.0      9  37.5   SB-IMPL::%READ-PRESERVING-WHITESPACE [84]
     1   4.2                   SB-IMPL::READ-MAYBE-NOTHING [85]
     1   4.2                   READ-CHAR [20]
     9  37.5                   SB-IMPL::%READ-PRESERVING-WHITESPACE [84]
------------------------------------------------------------------------
     9  37.5                   UIOP/STREAM:CALL-WITH-INPUT-FILE [82]
     0   0.0      9  37.5   UIOP/STREAM:SLURP-STREAM-FORMS [83]
     9  37.5                   SB-IMPL::%READ-PRESERVING-WHITESPACE [84]
------------------------------------------------------------------------
     3  12.5                   UIOP/STREAM:CALL-WITH-INPUT-FILE [82]
     4  16.7                   UIOP/STREAM:CALL-WITH-OUTPUT-FILE [38]
     0   0.0      7  29.2   OPEN [56]
     2   8.3                   foreign function access [9]
     1   4.2                   SB-IMPL::UNPARSE-NATIVE-UNIX-NAMESTRING [74]
     1   4.2                   SB-UNIX:UNIX-OPEN [68]
     3  12.5                   SB-SYS:MAKE-FD-STREAM [57]
------------------------------------------------------------------------
     2   8.3                   (FLET "CLEANUP-FUN-3" :IN UIOP/STREAM:CALL-WITH-INPUT-FILE) [86]
     5  20.8                   (FLET "CLEANUP-FUN-3" :IN UIOP/STREAM:CALL-WITH-OUTPUT-FILE) [69]
     0   0.0      7  29.2   (SB-PCL::FAST-METHOD CLOSE (SB-KERNEL:ANSI-STREAM)) [70]
     4  16.7                   SB-IMPL::RELEASE-FD-STREAM-RESOURCES [78]
     3  12.5                   SB-IMPL::FD-STREAM-MISC-ROUTINE [71]
------------------------------------------------------------------------
     5  20.8                   SB-IMPL::READ-LIST [21]
     1   4.2                   SB-IMPL::%READ-PRESERVING-WHITESPACE [84]
     0   0.0      7  29.2   SB-IMPL::READ-MAYBE-NOTHING [85]
     1   4.2                   SB-IMPL::RESET-READ-BUFFER [25]
     1   4.2                   SB-IMPL::READ-TOKEN [22]
     7  29.2                   SB-IMPL::READ-LIST [21]
------------------------------------------------------------------------
     5  20.8                   UIOP/STREAM:CALL-WITH-OUTPUT-FILE [38]
     0   0.0      5  20.8   (FLET "CLEANUP-FUN-3" :IN UIOP/STREAM:CALL-WITH-OUTPUT-FILE) [69]
     5  20.8                   (SB-PCL::FAST-METHOD CLOSE (SB-KERNEL:ANSI-STREAM)) [70]
------------------------------------------------------------------------
     4  16.7                   SB-IMPL::RELEASE-FD-STREAM-RESOURCES [78]
     0   0.0      4  16.7   (FLET "WITHOUT-INTERRUPTS-BODY-5" :IN SB-IMPL::RELEASE-FD-STREAM-RESOURCES) [79]
     4  16.7                   foreign function __close [2]
------------------------------------------------------------------------
     4  16.7                   (SB-PCL::FAST-METHOD CLOSE (SB-KERNEL:ANSI-STREAM)) [70]
     0   0.0      4  16.7   SB-IMPL::RELEASE-FD-STREAM-RESOURCES [78]
     4  16.7                   (FLET "WITHOUT-INTERRUPTS-BODY-5" :IN SB-IMPL::RELEASE-FD-STREAM-RESOURCES) [79]
------------------------------------------------------------------------
     3  12.5                   OPEN [56]
     0   0.0      3  12.5   SB-SYS:MAKE-FD-STREAM [57]
     2   8.3                   SB-UNIX:FD-TYPE [66]
     1   4.2                   SB-IMPL::SET-FD-STREAM-ROUTINES [13]
------------------------------------------------------------------------
     3  12.5                   SB-IMPL::FINISH-FD-STREAM-OUTPUT [72]
     0   0.0      3  12.5   SB-IMPL::FLUSH-OUTPUT-BUFFER [73]
     3  12.5                   foreign function __write [4]
------------------------------------------------------------------------
     3  12.5                   SB-IMPL::FD-STREAM-MISC-ROUTINE [71]
     0   0.0      3  12.5   SB-IMPL::FINISH-FD-STREAM-OUTPUT [72]
     3  12.5                   SB-IMPL::FLUSH-OUTPUT-BUFFER [73]
------------------------------------------------------------------------
     3  12.5                   (SB-PCL::FAST-METHOD CLOSE (SB-KERNEL:ANSI-STREAM)) [70]
     0   0.0      3  12.5   SB-IMPL::FD-STREAM-MISC-ROUTINE [71]
     3  12.5                   SB-IMPL::FINISH-FD-STREAM-OUTPUT [72]
------------------------------------------------------------------------
     2   8.3                   PPRINT-NEWLINE [48]
     0   0.0      2   8.3   SB-PRETTY::MAYBE-OUTPUT [49]
     1   4.2                   SB-PRETTY::OUTPUT-LINE [67]
     1   4.2                   SB-PRETTY::FITS-ON-LINE-P [50]
------------------------------------------------------------------------
     1   4.2                   (FLET "PPRINT-BLOCK" :IN PPRINT-FILL) [47]
     0   0.0      2   8.3   PPRINT-NEWLINE [48]
     2   8.3                   SB-PRETTY::MAYBE-OUTPUT [49]
------------------------------------------------------------------------
     1   4.2                   (LABELS SB-IMPL::HANDLE-IT :IN SB-KERNEL:OUTPUT-OBJECT) [41]
     0   0.0      2   8.3   SB-KERNEL:OUTPUT-SYMBOL [64]
     1   4.2                   SB-IMPL::%WRITE-STRING [12]
     1   4.2                   SB-IMPL::%FIND-SYMBOL [65]
------------------------------------------------------------------------
     1   4.2                   (LABELS #:BODY-NAME-3 :IN SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER) [46]
     0   0.0      2   8.3   (FLET "PPRINT-BLOCK" :IN SB-PRETTY::PPRINT-IF) [63]
     2   8.3                   (LABELS SB-IMPL::HANDLE-IT :IN SB-KERNEL:OUTPUT-OBJECT) [41]
------------------------------------------------------------------------
     1   4.2                   SB-PRETTY:OUTPUT-PRETTY-OBJECT [42]
     0   0.0      2   8.3   SB-PRETTY::PPRINT-IF [62]
     2   8.3                   SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER [44]
------------------------------------------------------------------------
     1   4.2                   SB-PRETTY:OUTPUT-PRETTY-OBJECT [42]
     0   0.0      2   8.3   SB-PRETTY::PPRINT-FUN-CALL [51]
     2   8.3                   SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER [44]
------------------------------------------------------------------------
     2   8.3                   SB-IMPL::TIME-GET-SYS-INFO [54]
     0   0.0      2   8.3   SB-SYS:GET-SYSTEM-INFO [55]
     2   8.3                   foreign function getrusage [6]
------------------------------------------------------------------------
     1   4.2                   CALL-WITH-TIMING [37]
     1   4.2                   (FLET "CLEANUP-FUN-14" :IN CALL-WITH-TIMING) [53]
     0   0.0      2   8.3   SB-IMPL::TIME-GET-SYS-INFO [54]
     2   8.3                   SB-SYS:GET-SYSTEM-INFO [55]
------------------------------------------------------------------------
     2   8.3                   SB-SYS:MAKE-FD-STREAM [57]
     0   0.0      2   8.3   SB-UNIX:FD-TYPE [66]
     2   8.3                   foreign function fstatat [1]
------------------------------------------------------------------------
     2   8.3                   UIOP/STREAM:CALL-WITH-INPUT-FILE [82]
     0   0.0      2   8.3   (FLET "CLEANUP-FUN-3" :IN UIOP/STREAM:CALL-WITH-INPUT-FILE) [86]
     2   8.3                   (SB-PCL::FAST-METHOD CLOSE (SB-KERNEL:ANSI-STREAM)) [70]
------------------------------------------------------------------------
     2   8.3                   SB-IMPL::NATIVE-FILE-KIND [92]
     0   0.0      2   8.3   SB-UNIX:UNIX-LSTAT [93]
     2   8.3                   foreign function fstatat [1]
------------------------------------------------------------------------
     2   8.3                   (FLET SB-IMPL::ITERATE :IN MAP-DIRECTORY) [91]
     0   0.0      2   8.3   SB-IMPL::NATIVE-FILE-KIND [92]
     2   8.3                   SB-UNIX:UNIX-LSTAT [93]
------------------------------------------------------------------------
     2   8.3                   SB-IMPL::CALL-WITH-NATIVE-DIRECTORY-ITERATOR [90]
     0   0.0      2   8.3   (FLET SB-IMPL::ITERATE :IN MAP-DIRECTORY) [91]
     2   8.3                   SB-IMPL::NATIVE-FILE-KIND [92]
------------------------------------------------------------------------
     2   8.3                   MAP-DIRECTORY [89]
     0   0.0      2   8.3   SB-IMPL::CALL-WITH-NATIVE-DIRECTORY-ITERATOR [90]
     2   8.3                   (FLET SB-IMPL::ITERATE :IN MAP-DIRECTORY) [91]
------------------------------------------------------------------------
     2   8.3                   (LABELS SB-IMPL::RECURSE :IN DELETE-DIRECTORY) [88]
     0   0.0      2   8.3   MAP-DIRECTORY [89]
     2   8.3                   SB-IMPL::CALL-WITH-NATIVE-DIRECTORY-ITERATOR [90]
------------------------------------------------------------------------
     2   8.3                   SXP-BENCH:RUN-BENCH [35]
     0   0.0      2   8.3   (LABELS SB-IMPL::RECURSE :IN DELETE-DIRECTORY) [88]
     2   8.3                   MAP-DIRECTORY [89]
------------------------------------------------------------------------
     1   4.2                   SB-PRETTY::MAYBE-OUTPUT [49]
     0   0.0      1   4.2   SB-PRETTY::FITS-ON-LINE-P [50]
     1   4.2                   SB-PRETTY::INDEX-COLUMN [10]
------------------------------------------------------------------------
     0   0.0      1   4.2   foreign function interrupt_handle_pending [52]
     1   4.2                   foreign function pthread_sigmask [11]
------------------------------------------------------------------------
     1   4.2                   CALL-WITH-TIMING [37]
     0   0.0      1   4.2   (FLET "CLEANUP-FUN-14" :IN CALL-WITH-TIMING) [53]
     1   4.2                   SB-IMPL::TIME-GET-SYS-INFO [54]
------------------------------------------------------------------------
     1   4.2                   (LAMBDA (SB-IMPL::D) :IN SB-IMPL::PRINT-FLOAT) [58]
     0   0.0      1   4.2   SB-PRETTY::PRETTY-OUT [59]
     1   4.2                   SB-PRETTY::ENSURE-SPACE-IN-BUFFER [3]
------------------------------------------------------------------------
     1   4.2                   SB-IMPL::PRINT-FLOAT [14]
     0   0.0      1   4.2   (LAMBDA (SB-IMPL::D) :IN SB-IMPL::PRINT-FLOAT) [58]
     1   4.2                   SB-PRETTY::PRETTY-OUT [59]
------------------------------------------------------------------------
     1   4.2                   SB-PRETTY::START-LOGICAL-BLOCK [60]
     0   0.0      1   4.2   SB-PRETTY::PRETTY-SOUT [61]
     1   4.2                   SB-PRETTY::ENSURE-SPACE-IN-BUFFER [3]
------------------------------------------------------------------------
     1   4.2                   (LABELS #:BODY-NAME-3 :IN SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER) [46]
     0   0.0      1   4.2   SB-PRETTY::START-LOGICAL-BLOCK [60]
     1   4.2                   SB-PRETTY::PRETTY-SOUT [61]
------------------------------------------------------------------------
     1   4.2                   SB-KERNEL:OUTPUT-SYMBOL [64]
     0   0.0      1   4.2   SB-IMPL::%FIND-SYMBOL [65]
     1   4.2                   SB-IMPL::%LOOKUP-SYMBOL [15]
------------------------------------------------------------------------
     1   4.2                   SB-PRETTY::MAYBE-OUTPUT [49]
     0   0.0      1   4.2   SB-PRETTY::OUTPUT-LINE [67]
     1   4.2                   SB-IMPL::%WRITE-STRING [12]
------------------------------------------------------------------------
     1   4.2                   OPEN [56]
     0   0.0      1   4.2   SB-UNIX:UNIX-OPEN [68]
     1   4.2                   SB-IMPL::OUTPUT-TO-C-STRING/UTF-8 [17]
------------------------------------------------------------------------
     1   4.2                   SB-IMPL::UNPARSE-NATIVE-UNIX-NAMESTRING [74]
     0   0.0      1   4.2   SB-IMPL::UNPARSE-NATIVE-PHYSICAL-FILE [75]
     1   4.2                   PATHNAME-TYPE [18]
------------------------------------------------------------------------
     1   4.2                   OPEN [56]
     0   0.0      1   4.2   SB-IMPL::UNPARSE-NATIVE-UNIX-NAMESTRING [74]
     1   4.2                   SB-IMPL::UNPARSE-NATIVE-PHYSICAL-FILE [75]
------------------------------------------------------------------------
     1   4.2                   (LABELS SB-IMPL::HANDLE-IT :IN SB-KERNEL:OUTPUT-OBJECT) [41]
     0   0.0      1   4.2   (SB-PCL::FAST-METHOD PRINT-OBJECT (FLOAT T)) [77]
     1   4.2                   FLOAT-SIGN [19]
------------------------------------------------------------------------
     1   4.2                   (LABELS #:BODY-NAME-3 :IN SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER) [46]
     0   0.0      1   4.2   (FLET "PPRINT-BLOCK" :IN SB-PRETTY::PPRINT-FUN-CALL) [76]
     1   4.2                   (LABELS SB-IMPL::HANDLE-IT :IN SB-KERNEL:OUTPUT-OBJECT) [41]
------------------------------------------------------------------------
     1   4.2                   SB-IMPL::INPUT-CHAR/UTF-8 [8]
     0   0.0      1   4.2   SB-IMPL::REFILL-INPUT-BUFFER [87]
     1   4.2                   foreign function read [26]
------------------------------------------------------------------------


           Self        Total        Cumul
  Nr  Count     %  Count     %  Count     %    Calls  Function
------------------------------------------------------------------------
   1      4  16.7      4  16.7      4  16.7        -  foreign function fstatat
   2      4  16.7      4  16.7      8  33.3        -  foreign function __close
   3      3  12.5      3  12.5     11  45.8        -  SB-PRETTY::ENSURE-SPACE-IN-BUFFER
   4      3  12.5      3  12.5     14  58.3        -  foreign function __write
   5      3  12.5      3  12.5     17  70.8        -  foreign function __open64
   6      2   8.3      3  12.5     19  79.2        -  SB-IMPL::INPUT-CHAR/UTF-8
   7      2   8.3      2   8.3     21  87.5        -  foreign function getrusage
   8      2   8.3      2   8.3     23  95.8        -  TRUNCATE
   9      2   8.3      2   8.3     25 104.2        -  foreign function access
  10      1   4.2      7  29.2     26 108.3        -  SB-IMPL::READ-LIST
  11      1   4.2      4  16.7     27 112.5        -  SB-IMPL::PRINT-FLOAT
  12      1   4.2      4  16.7     28 116.7        -  READ-CHAR
  13      1   4.2      4  16.7     29 120.8        -  SB-IMPL::READ-TOKEN
  14      1   4.2      3  12.5     30 125.0        -  SB-IMPL::%WRITE-STRING
  15      1   4.2      1   4.2     31 129.2        -  SB-PRETTY::INDEX-COLUMN
  16      1   4.2      1   4.2     32 133.3        -  foreign function pthread_sigmask
  17      1   4.2      1   4.2     33 137.5        -  SB-IMPL::SET-FD-STREAM-ROUTINES
  18      1   4.2      1   4.2     34 141.7        -  SB-IMPL::%LOOKUP-SYMBOL
  19      1   4.2      1   4.2     35 145.8        -  SB-IMPL::FD-SOUT
  20      1   4.2      1   4.2     36 150.0        -  SB-IMPL::OUTPUT-TO-C-STRING/UTF-8
  21      1   4.2      1   4.2     37 154.2        -  PATHNAME-TYPE
  22      1   4.2      1   4.2     38 158.3        -  FLOAT-SIGN
  23      1   4.2      1   4.2     39 162.5        -  DIGIT-CHAR-P
  24      1   4.2      1   4.2     40 166.7        -  SB-IMPL::FLUSH-WHITESPACE
  25      1   4.2      1   4.2     41 170.8        -  SB-IMPL::RESET-READ-BUFFER
  26      1   4.2      1   4.2     42 175.0        -  foreign function read
  27      0   0.0     39 162.5     42 175.0        -  SXP-BENCH:RUN-BENCH
  28      0   0.0     39 162.5     42 175.0        -  SB-INT:SIMPLE-EVAL-IN-LEXENV
  29      0   0.0     39 162.5     42 175.0        -  EVAL
  30      0   0.0     39 162.5     42 175.0        -  SB-IMPL::PROCESS-EVAL/LOAD-OPTIONS
  31      0   0.0     39 162.5     42 175.0        -  SB-IMPL::TOPLEVEL-INIT
  32      0   0.0     39 162.5     42 175.0        -  (FLET SB-UNIX::BODY :IN SB-IMPL::START-LISP)
  33      0   0.0     39 162.5     42 175.0        -  (FLET "WITHOUT-INTERRUPTS-BODY-3" :IN SB-IMPL::START-LISP)
  34      0   0.0     39 162.5     42 175.0        -  SB-IMPL::%START-LISP
  35      0   0.0     39 162.5     42 175.0        -  foreign function call_into_lisp_
  36      0   0.0     37 154.2     42 175.0        -  CALL-WITH-TIMING
  37      0   0.0     23  95.8     42 175.0        -  SXP-BENCH::WBENCH
  38      0   0.0     21  87.5     42 175.0        -  UIOP/STREAM:CALL-WITH-OUTPUT-FILE
  39      0   0.0     14  58.3     42 175.0        -  UIOP/STREAM:CALL-WITH-INPUT-FILE
  40      0   0.0     14  58.3     42 175.0        -  SXP:READ-SXP-FILE
  41      0   0.0     14  58.3     42 175.0        -  SXP-BENCH::RBENCH
  42      0   0.0     12  50.0     42 175.0        -  (FLET "PPRINT-BLOCK" :IN PPRINT-FILL)
  43      0   0.0     12  50.0     42 175.0        -  (LABELS #:BODY-NAME-3 :IN SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER)
  44      0   0.0     12  50.0     42 175.0        -  (FLET "WITH-PRETTY-STREAM0" :IN SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER)
  45      0   0.0     12  50.0     42 175.0        -  SB-PRETTY::CALL-LOGICAL-BLOCK-PRINTER
  46      0   0.0     12  50.0     42 175.0        -  PPRINT-FILL
  47      0   0.0     12  50.0     42 175.0        -  SB-PRETTY:OUTPUT-PRETTY-OBJECT
  48      0   0.0     12  50.0     42 175.0        -  (LABELS SB-IMPL::HANDLE-IT :IN SB-KERNEL:OUTPUT-OBJECT)
  49      0   0.0     12  50.0     42 175.0        -  PRIN1
  50      0   0.0     12  50.0     42 175.0        -  PRINT
  51      0   0.0      9  37.5     42 175.0        -  SB-IMPL::%READ-PRESERVING-WHITESPACE
  52      0   0.0      9  37.5     42 175.0        -  UIOP/STREAM:SLURP-STREAM-FORMS
  53      0   0.0      7  29.2     42 175.0        -  OPEN
  54      0   0.0      7  29.2     42 175.0        -  (SB-PCL::FAST-METHOD CLOSE (SB-KERNEL:ANSI-STREAM))
  55      0   0.0      7  29.2     42 175.0        -  SB-IMPL::READ-MAYBE-NOTHING
  56      0   0.0      5  20.8     42 175.0        -  (FLET "CLEANUP-FUN-3" :IN UIOP/STREAM:CALL-WITH-OUTPUT-FILE)
  57      0   0.0      4  16.7     42 175.0        -  (FLET "WITHOUT-INTERRUPTS-BODY-5" :IN SB-IMPL::RELEASE-FD-STREAM-RESOURCES)
  58      0   0.0      4  16.7     42 175.0        -  SB-IMPL::RELEASE-FD-STREAM-RESOURCES
  59      0   0.0      3  12.5     42 175.0        -  SB-SYS:MAKE-FD-STREAM
  60      0   0.0      3  12.5     42 175.0        -  SB-IMPL::FLUSH-OUTPUT-BUFFER
  61      0   0.0      3  12.5     42 175.0        -  SB-IMPL::FINISH-FD-STREAM-OUTPUT
  62      0   0.0      3  12.5     42 175.0        -  SB-IMPL::FD-STREAM-MISC-ROUTINE
  63      0   0.0      2   8.3     42 175.0        -  SB-PRETTY::MAYBE-OUTPUT
  64      0   0.0      2   8.3     42 175.0        -  PPRINT-NEWLINE
  65      0   0.0      2   8.3     42 175.0        -  SB-KERNEL:OUTPUT-SYMBOL
  66      0   0.0      2   8.3     42 175.0        -  (FLET "PPRINT-BLOCK" :IN SB-PRETTY::PPRINT-IF)
  67      0   0.0      2   8.3     42 175.0        -  SB-PRETTY::PPRINT-IF
  68      0   0.0      2   8.3     42 175.0        -  SB-PRETTY::PPRINT-FUN-CALL
  69      0   0.0      2   8.3     42 175.0        -  SB-SYS:GET-SYSTEM-INFO
  70      0   0.0      2   8.3     42 175.0        -  SB-IMPL::TIME-GET-SYS-INFO
  71      0   0.0      2   8.3     42 175.0        -  SB-UNIX:FD-TYPE
  72      0   0.0      2   8.3     42 175.0        -  (FLET "CLEANUP-FUN-3" :IN UIOP/STREAM:CALL-WITH-INPUT-FILE)
  73      0   0.0      2   8.3     42 175.0        -  SB-UNIX:UNIX-LSTAT
  74      0   0.0      2   8.3     42 175.0        -  SB-IMPL::NATIVE-FILE-KIND
  75      0   0.0      2   8.3     42 175.0        -  (FLET SB-IMPL::ITERATE :IN MAP-DIRECTORY)
  76      0   0.0      2   8.3     42 175.0        -  SB-IMPL::CALL-WITH-NATIVE-DIRECTORY-ITERATOR
  77      0   0.0      2   8.3     42 175.0        -  MAP-DIRECTORY
  78      0   0.0      2   8.3     42 175.0        -  (LABELS SB-IMPL::RECURSE :IN DELETE-DIRECTORY)
  79      0   0.0      1   4.2     42 175.0        -  SB-PRETTY::FITS-ON-LINE-P
  80      0   0.0      1   4.2     42 175.0        -  foreign function interrupt_handle_pending
  81      0   0.0      1   4.2     42 175.0        -  (FLET "CLEANUP-FUN-14" :IN CALL-WITH-TIMING)
  82      0   0.0      1   4.2     42 175.0        -  SB-PRETTY::PRETTY-OUT
  83      0   0.0      1   4.2     42 175.0        -  (LAMBDA (SB-IMPL::D) :IN SB-IMPL::PRINT-FLOAT)
  84      0   0.0      1   4.2     42 175.0        -  SB-PRETTY::PRETTY-SOUT
  85      0   0.0      1   4.2     42 175.0        -  SB-PRETTY::START-LOGICAL-BLOCK
  86      0   0.0      1   4.2     42 175.0        -  SB-IMPL::%FIND-SYMBOL
  87      0   0.0      1   4.2     42 175.0        -  SB-PRETTY::OUTPUT-LINE
  88      0   0.0      1   4.2     42 175.0        -  SB-UNIX:UNIX-OPEN
  89      0   0.0      1   4.2     42 175.0        -  SB-IMPL::UNPARSE-NATIVE-PHYSICAL-FILE
  90      0   0.0      1   4.2     42 175.0        -  SB-IMPL::UNPARSE-NATIVE-UNIX-NAMESTRING
  91      0   0.0      1   4.2     42 175.0        -  (SB-PCL::FAST-METHOD PRINT-OBJECT (FLOAT T))
  92      0   0.0      1   4.2     42 175.0        -  (FLET "PPRINT-BLOCK" :IN SB-PRETTY::PPRINT-FUN-CALL)
  93      0   0.0      1   4.2     42 175.0        -  SB-IMPL::REFILL-INPUT-BUFFER
------------------------------------------------------------------------
          0   0.0                                     elsewhere
#+end_example

** Emacs Lisp
The Emacs Lisp implementation is a single file in the root directory
which mimicks the behavior of the Common Lisp implementation.

#+name: sxp-el-make
#+begin_src shell :results output replace :exports both
make el
#+end_src

#+RESULTS: sxp-el-make
: emacs --batch --eval '(native-compile "sxp.el")' --eval '(byte-compile-file "sxp.el")'

** TODO Rust
The Rust reference implementation is located in the =rust= folder of
this project. It leverages the serde ecosystem and includes a full
test-suite as specified in the previous section.
#+name: sxp-rs-make
#+begin_src shell :results replace output :exports both
  make rs
#+end_src

*** examples
**** udp
This example shows a basic network example which used SXP as the data
exchange format. You should run an instance of it in two separate
terminals to see the effects of serialization.
#+name: sxp-rs-udp-example
#+begin_src shell :results output replace :exports both
  make rs-udp
#+end_src

#+begin_example
(:id 1 :key "\n���\u0017�2��\t�Zo����p���\u001f�^bG�k�\\ߖ" :payload (0.8739031788256151 0.1771574880771607 0.03755418751921791 0.0830789940011788 0.25999368753618635 0.7759811623689914 0.377905715625487 0.6345103836577041 0.9280487838838453 0.05632381798743469 0.47706941126106617 0.8630071004646652 0.3105367297573872 0.9638316414175672 0.9654394218166857 0.0960356381113201 0.5948876380109583 0.008619085472148957 0.6972437660928477 0.9956387178318982 0.8393661712357147 0.026006527729574347 0.18933612631846053 0.4658786468455528 0.6120269120388118 0.6799305559125147 0.4786783590209269 0.5468187309042902 0.7516485541529964 0.9640651422693095 0.8131540890045137 0.05743081471017575))
(:id 2 :key "܇n�X�\u0016��\u0011�|w��\u001c�tex�`�Beo3�����" :payload (0.014856226454673549 0.6702861790951982 0.8235206974459348 0.6124713202885237 0.253919658282998 0.24875903256773413 0.4904138875177353 0.5537123036987349 0.9920025280418244 0.7964545899597759 0.5153814811979214 0.9973232205716195 0.16431485741870144 0.05187173892574937 0.7518792564089343 0.39048883728773587 0.1201476618851095 0.7742171756709769 0.32517551295944525 0.6370041691338797 0.29961162890042525 0.3088199026426365 0.16149301204961397 0.12717608917477208 0.28539724001716305 0.19111150731484594 0.16116319138709223 0.21695737106587532 0.3694178306438769 0.5704838578555591 0.4015937765848465 0.4534098319855393))
(:id 3 :key "od�s���{�\t�\u0016�\"\u0007�{<K���O���\u000bs��#\u0004" :payload (0.5988960943914401 0.18507424718905252 0.5066858621969329 0.27237868503536233 0.7889265093317402 0.8003426474329407 0.8029753091140293 0.23018429888116942 0.6220222102084081 0.6035229536781057 0.21460422291936299 0.20473839314063358 0.6230553158310311 0.8176107505641151 0.33376990736027745 0.5472771996439204 0.013756761117554639 0.362542310894191 0.23198218329151443 0.9807665214331935 0.8475009571273702 0.3179886946114975 0.8472699063062974 0.541594646958305 0.47297569792693883 0.2127092570608261 0.7382601315774998 0.6504966714809076 0.6206151994181767 0.8116706208036837 0.9223858519359078 0.40749529457577893))
(:id 4 :key "�k���,ܬ\u0005�ĺ\u0012�Y��\u0006}r!!��\u0018�`�/d�0" :payload (0.9926646483886535 0.04957913627550603 0.42501054802544724 0.6781155309850084 0.7488395990975232 0.12480437219134854 0.10368924105933253 0.12432160945673953 0.4292784007510758 0.07930439320824811 0.9928754832618009 0.9398896399172157 0.7857588766640731 0.8879130212960369 0.5182342888846501 0.523730438771649 0.48472768121039833 0.947544728574599 0.21729738216462635 0.29655873380009157 0.8122432664243706 0.2440411601862399 0.9521903618713258 0.6537431169922238 0.816525253650528 0.2612954660003107 0.1865916410218087 0.3842286630646984 0.9084756918516721 0.9518635753352582 0.33045307514389477 0.04210025808991458))
#+end_example
* COMMENT notes
** draft1
S-eXPressions[fn:2].

[fn:2]  Pronounced 'es-ex-pee' not 'sex-pee' 
*** Overview
*SXP* is an attempt at making S-Expressions into a robust /meta data
 format/. It consists of the modern rules of S-Expression described in
 the introduction (nil is defined, we can omit dots), a set of
 well-defined tokens and atoms, a list type, a formatter, and a
 framework for extending the /reader/ and /writer/ of any given SXP
 implementation via macros.
**** Prior Art
The sections preceeding this one were written without doing any
research really, but I did find a relevant proposal: see
[[file:draft-rivest-sexp-00.txt][draft-rivest-sexp-00.txt]]. It's the same idea with a different
approach - the focus is on an exact binary format which is referred to
as the Canonical representation. There are additional representations
available through custom printer modes.

There is also something called [[https://twisted.org/documents/16.1.1/core/specifications/banana.html][Banana]] which is an extensible
/transport/ protocol for sending and receiving S-expressions. Again
quite similar - binary format using tagged values.

A C++/C library called [[https://github.com/mjsottile/sfsexp][sfsexp]] is available. It looks quite good
actually and I'm excited to test it further.

For some additional simple implementations, check out [[https://rosettacode.org/wiki/S-expressions][S-expressions on
Rosetta Code]].
*** Atoms
Atoms are the indivisible units of a SXP -- they are used as the
internal representation of our data which is manipulated in the
structures supported by a given implementation.
**** Numbers
#+begin_example
numeric-token  ::=  integer |
				   ratio   |
				   float       
integer        ::=  [sign]
				   decimal-digit+
				   decimal-point |
				   [sign]
				   digit+      
ratio          ::=  [sign]
				   {digit}+
				   slash
				   {digit}+    
float          ::=  [sign]
				   {decimal-digit}*
				   decimal-point
				   {decimal-digit}+
				   [exponent]  
                    | 
				   [sign]
				   {decimal-digit}+
				   [decimal-point
					   {decimal-digit}*]
				   exponent    
exponent       ::=  exponent-marker
				   [sign]
				   {digit}+    
                                       
sign---a sign.                         
slash---a slash                        
decimal-point---a dot.                        
exponent-marker---an exponent marker.                        
decimal-digit---a digit in radix 10.                        
digit---a digit in the current input radix.  
#+end_example
see also: [[http://clhs.lisp.se/Body/02_caa.htm][potential numbers]]
**** Strings
[[http://clhs.lisp.se/Body/02_de.htm][CLHS]] 
#+begin_example
  The double-quote is used to begin and end a string. When a
  double-quote is encountered, characters are read from the input stream
  and accumulated until another double-quote is encountered. If a single
  escape character is seen, the single escape character is discarded,
  the next character is accumulated, and accumulation continues. The
  accumulated characters up to but not including the matching
  double-quote are made into a simple string and returned. It is
  implementation-dependent which attributes of the accumulated
  characters are removed in this process.

  Examples of the use of the double-quote character are in the next
  figure.

  "Foo"                      ;A string with three characters in it  
  ""                         ;An empty string                       
  "\"APL\\360?\" he cried."  ;A string with twenty characters       
  "|x| = |-x|"               ;A ten-character string   
#+end_example
**** Symbols
[[http://clhs.lisp.se/Body/02_cd.htm][CLHS]]
#+begin_example
  Any token that is not a potential number, does not contain a package
  marker, and does not consist entirely of dots will always be
  interpreted as a symbol. Any token that is a potential number but does
  not fit the number syntax is a reserved token and has an
  implementation-dependent interpretation. In all other cases, the token
  is construed to be the name of a symbol.
#+end_example
*** Lists
*** Macros
Macros are the mechanism by which a SXP reader and writer are
extended. They are driven by individual function lookup tables -
referred to as the ~readtable~ and ~writetable~ respectively. These
tables are indexed separately but store the same core 'Macro' type.

Macros receive and return a single S-Expression object, but are used
by the parser in different ways.

**** Reader Macros
Reader Macros occur during /deserialization/. When the unquoted =#=
character is encountered, the next character is matched against a
hashtable of /read symbols/ and the corresponding function is called
on the remainder of the input or until control is returned to the
Deserializer.  See [[http://clhs.lisp.se/Body/v_rdtabl.htm#STreadtableST][*readtable*]]
**** Writer Macros
Writer Macros occur during /serialization/ before being passed to the
output formatter/writer. They allow for transformations of SXPs in
memory. Note that this does /not/ modify the printed (formatted) representation,
only the internal representation.

#+COMMENT: is this possible..
# One important property of writer macros is that they are
# recursive. You can write macros which expand into other macros. This
# is achieved with a new atom type only available in the context of
# /writer macroexpansion/. Once all branches have been resolved, we are
# left with our finalized S-expression which can be passed to the
# Formatter.
The most direct analogy to these macros in CL are actually /compiler
macros/, as we are effectively defining optimization passes which
search for and replace specific patterns of code.
*** Formatter
The final component of SXP is the formatter. This is the /first/
transformation made at read-time, and the /last/ at write-time.

Unlike macros, formatters are interfaces which translate streams of
/tokens/ using functions of the form: ~format-input~ (deserialize,
raw->tok) and ~format-output~ (serialize, tok->raw).
- format-input ::
  given raw data parameterized by the formatter specification, return
  a sequence of tokens.
- format-output ::
  given a sequence of tokens, return raw data parameterized by the
  formatter specification.

All formatters are mutually exclusive - an S-expression read with a
specific formatter must be written with the methods of that same
formatter.
**** Default
For now, I would like to use UTF-8 Strings as the canonical (default)
format. This is a re-definition of the term originally attributed to a
compact binary specification (see prior art). No new lines - only
spaces.
**** Pretty
A pretty-printed UTF-8 string. newline and indentation parameters, etc.
**** Binary
A well-defined binary data representation, usually an array of bytes
(u8).
**** COMMENT Compact
# compressed?
**** Custom
User-defined formatter.
*** Test Suite
This section provides a test suite which can be used for verifying and
benchmarking an implementation as shown in the reference
implementation.
- test data ::
  - =./tests.sxp=
**** parser tests
SXP implementations are required to convert data from arbitrary
streams into an internal Tree representation.
**** serialization tests
**** deserialization tests
**** formatter tests
**** macro tests
** form vs forms
